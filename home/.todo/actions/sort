#!/bin/bash
export DATE=`date +%Y%m%d`

if type gsed &>/dev/null; then
  SED=gsed
else
  SED=sed
fi

if type gsort &>/dev/null; then
  SORT=gsort
else
  SORT=sort
fi

cat |
  # Prepend dates, in the format 20160101, to every line with a due date
  $SED 's/\(.* due:\([0-9]\{4\}\)-\([0-9]\{2\}\)-\([0-9]\{2\}\)\( .*\|$\)\)/\2\3\4 \1/' |
  # Prepend all-nines to any line without a due date
  $SED '/^[0-9]\{8\}/!s/^/99999999 /' |
  # Sort by the first column, by number
  env LC_COLLATE=C $SORT -k1,1n -k3f
