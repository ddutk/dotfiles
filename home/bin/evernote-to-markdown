#!/bin/sh

IFS='
'
for notebook in `geeknote notebook-list | grep ' : ' | sed 's/.* : //'`; do
  mkdir "$notebook"
  cd "$notebook"

  echo "Backing up $notebook:"

  geeknote find --count 999 --notebooks "$notebook" > out.list
  numfound=`cat out.list | grep 'Total found: ' | cut -d' ' -f3`

  for notenum in `seq 1 $numfound`; do
    title="`cat out.list | grep " $notenum : " | sed 's/.*2013  //'`"
    filename="`echo "$title" | sed -e "s/[/:?]/_/g"`"

    echo "...$title"

    geeknote show $notenum | sed '1d;3d;4d;5d' | sed '/^Tags: /{x;p;x;G;}' | sed '3s/\([:,] \)/\1#/g' | sed '1s/^/# /' > "$filename.md"
  done

  rm out.list
  cd ..

done
