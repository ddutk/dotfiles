#!/bin/sh
# Export mail in the Apple Mail 'Export' folder to an mbox in the
# current directory (run this in a Temporary folder!).

# We don't want there to already be "Export" or "Converted" directories, or they'll
# be overwritten!
if test -d "./Export" -o -d "./Converted" ; then
  echo "ERROR: Cannot run script, your 'Export' or 'Converted' directories here would be overwritten!"
  exit 1
fi

mkdir Export
cp -R ~/Library/Mail/Mailboxes/Export.mbox Export

~/bin/mail/emlx2mbox Export

rm -r Export

mv Converted/Export-mbox ./Export.mbox
bzip2 -9 Export.mbox

rm -r Converted

