#!/bin/bash
# Send a Garmin FIT file to Smashrun, with conversion.  Needs Mutt installed
# and functional local sendmail (msmtp, esmtp, etc.) to send the e-mails.

if [ "$1" = "--help" -o $# -ne 1 ]; then
  echo "$0: send a Garmin FIT file to Smashrun"
  echo ""
  echo "Usage: $0 <file.fit>"
  exit 1
fi

FIT="$1"
TCX="$TMPDIR/`basename "$FIT" .fit`.tcx"

rm -f $TCX
gpsbabel -i garmin_fit -f "$FIT" -o gtrnctr,course=no,sport=Running -F "$TCX"

echo "Submitting TCX file." | mutt -s "Submitting TCX file" -a "$TCX" -- cpence@smashrun.com

rm -f "$TCX"
