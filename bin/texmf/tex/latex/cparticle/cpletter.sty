\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{cpletter}[2012/04/19 C. Pence Letterhead Template]

% AMS
\RequirePackage{amssymb}
\RequirePackage{amsmath}
\RequirePackage{amsthm}

% Fonts
\usepackage[protrusion=true,final]{microtype}
\usepackage{fontspec}
\usepackage{unicode-math}
\defaultfontfeatures{Ligatures=Common,Mapping=tex-text}
\setmainfont{Gentium Book Basic}
\setsansfont[Scale=MatchLowercase,LetterSpace=-1.8,BoldFont=Lucida Sans Demibold Roman,ItalicFont=Lucida Sans Italic]{Lucida Sans Unicode}
\setmonofont[Scale=MatchLowercase]{Droid Sans Mono}
\setmathfont{Neo Euler}
% Map italic back to upright, since Euler doesn't have italics
\setmathfont[range=\mathit/{greek,Greek,latin,Latin}->\mathup]{Neo Euler}

\newfontfamily\oldstandard{Old Standard}

\usepackage{ellipsis}

% Page
\usepackage[letterpaper,left=1.85in,right=1.85in,top=1in,bottom=1.25in]{geometry}

% Spacing
\setlength{\parindent}{2\baselineskip}


% Footnotes
\RequirePackage{hanging}
\RequirePackage{settobox}
\newsavebox{\cpafnotemark}
\newlength{\cpafnote}
% This is almost the same as the 'hangparas' environment, but 'hangparas'
% has some whitespace in its definition, which causes the insertion of a space
% that destroys the precise alignment that I'm building here.  So I redefine
% 'hangparas' as 'cpafootnote'.
\newenvironment{cpafootnote}[2]{\setlength{\parindent}{1em}\everypar={\hangpara{#1}{#2}}}{\par}
\renewcommand\@makefntext[1]{%
    \sbox{\cpafnotemark}{\@thefnmark.\hspace{0.5ex}}
    \settoboxwidth{\cpafnote}{\cpafnotemark}
    \noindent\usebox{\cpafnotemark}\begin{cpafootnote}{\cpafnote}{0}\hangpara{\cpafnote}{1}#1\end{cpafootnote}}


% Section Headers
\RequirePackage[tiny,sf]{titlesec}
\newcommand{\cpahfamily}{\sffamily}
\newcommand{\cpahbig}{\normalsize}
\titleformat{\section}[hang]
  {\cpahbig\cpahfamily}
  {\thesection.}
  {0.5em}
  {}
\titlespacing*{\section}{0pt}{\baselineskip}{0.84\baselineskip}
\titleformat{\subsection}[hang]
  {\normalsize\cpahfamily}
  {\thesubsection.}
  {0.5em}
  {}
\titleformat{\subsubsection}[hang]
  {\normalsize\cpahfamily}
  {{\upshape\thesubsubsection.}}
  {0.5em}
  {}


% Header and footer
\RequirePackage{fancyhdr}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0.0pt}
\setlength{\headsep}{0pt}

\fancypagestyle{plain}{
  \fancyhead{}
  \fancyfoot{}
  \fancyfoot[C]{\thepage}  
}
\pagestyle{plain}

\fancypagestyle{first}{
  \fancyhead{}
  % â€¢
  \fancyfoot[C]{\oldstandard\fontsize{8}{13}\selectfont \itshape University of Notre Dame, 453 Geddes Hall, Notre Dame, IN 46556 USA \\ http://charlespence.net --- charles@charlespence.net}
}


% The actual letterhead
\AtBeginDocument{
  \frenchspacing
  
  \vspace{0.25in}
  \begin{center}
    {\oldstandard\fontsize{24}{24}\selectfont \addfontfeature{WordSpace=1.8,LetterSpace=5} CHARLES H. PENCE} \\[15pt]
    {\oldstandard\fontsize{8}{11}\selectfont \addfontfeature{WordSpace=1.8} GRADUATE STUDENT, PROGRAM IN HISTORY AND \\ PHILOSOPHY OF SCIENCE}
  \end{center}
  \vspace{0.5in}

  \thispagestyle{first}
  \fontsize{11}{15}\selectfont
}

% Woo signature
\RequirePackage{graphicx}
\newcommand{\signature}{\includegraphics[width=2in]{signature.pdf}}

\endinput
