#!/bin/bash

if [[ -e "$HOME/Library/Containers/com.culturedcode.things/Data/Library/Application Support/Cultured Code/Things/ThingsLibrary.db" ]]; then
  cp "$HOME/Library/Containers/com.culturedcode.things/Data/Library/Application Support/Cultured Code/Things/ThingsLibrary.db" .
elif [[ -e "$HOME/Library/Application Support/Cultured Code/Things/ThingsLibrary.db" ]]; then
  cp "$HOME/Library/Application Support/Cultured Code/Things/ThingsLibrary.db" .
fi

if [ -e ThingsLibrary.db ]; then
  xz -9 ThingsLibrary.db
  mv ThingsLibrary.db.xz ~/Dropbox/Charles/Storage/Backup/
fi

open -a Things
sleep 2

osascript ~/bin/backup/things.scpt > todo.txt
sleep 1

xz -9 todo.txt
mv todo.txt.xz ~/Dropbox/Charles/Storage/Backup/
