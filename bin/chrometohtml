#!/usr/bin/python
# Export Chrome bookmarks to HTML

import json
import datetime
import cgi
import os
import sys

user = os.getlogin()
input_filename = "/Users/%s/Library/Application Support/Google/Chrome/Default/Bookmarks" % user
# modify if necessary
output_filename = "/Users/%s/Dropbox/Charles/Documents/Personal/Bookmarks.html" % user

input_file = open(input_filename)
bookmark_data = json.load(input_file)
output_file = open(output_filename, 'w', 0)
sys.stdout = output_file

def print_bookmarks(bookmarks):
   for entry in bookmarks:
      if entry['type'] == 'folder':
         if not len(entry['children']) == 0:
            print ('<DT><H3 FOLDED ADD_DATE="%s">%s</H3>' % (entry['date_added'], entry['name'])).encode('utf-8')
            next_folder = entry['children']
            print '<DL><p>'
            print_bookmarks(next_folder)
            print '</DL><p>'
      else:
         print ('<DT><A DATE_ADDED="%s" HREF="%s">%s</A>' % (entry['date_added'], cgi.escape(entry['url']), entry['name'])).encode('utf-8')


print '<!DOCTYPE NETSCAPE-Bookmark-file-1>\n<Title>Bookmarks</Title>\n<H1>Bookmarks</H1><DL>\n'

roots = bookmark_data['roots']

for entry in roots:
   print ('<DT><H3 FOLDED ADD_DATE="%s">%s</H3>' % (roots[entry]['date_added'], entry)).encode('utf-8')
   print_bookmarks(roots[entry]['children'])
   print "</DL><p>"
   
print "</DL>"
